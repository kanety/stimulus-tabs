{"version":3,"file":"index.module.js","sources":["../src/store.js","../src/index.js"],"sourcesContent":["export default class Store {\n  constructor(controller) {\n    this.controller = controller;\n  }\n\n  get tabs() {\n    return this.controller.tabs;\n  }\n\n  get currentTabs() {\n    return this.controller.currentTabs;\n  }\n\n  get key() {\n    return this.controller.storeKeyValue;\n  }\n\n  load() {\n    let ids = this.constructor.load(this.key);\n    if (!ids) return;\n\n    let idSet = new Set(ids);\n    this.tabs.forEach(tab => {\n      let pane = this.controller.findPane(tab);\n      if (idSet.has(this.controller.getPaneID(tab))) {\n        this.controller.toggleClass(tab, pane, true);\n      } else {\n        this.controller.toggleClass(tab, pane, false);\n      }\n    });\n  }\n\n  save() {\n    let ids = this.currentTabs.map(tab => this.controller.getPaneID(tab));\n    this.constructor.save(this.key, ids);\n  }\n\n  static load(key) {\n    if (!key) return;\n    let json = sessionStorage.getItem(key);\n    try {\n      return JSON.parse(json)\n    } catch {\n      return null;\n    }\n  }\n\n  static save(key, value) {\n    if (!key) return;\n    sessionStorage.setItem(key, JSON.stringify(value));\n  }\n}\n","import { Controller } from '@hotwired/stimulus';\nimport Store from './store';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    storeKey: String\n  };\n\n  get tabs() {\n    return this.context.bindingObserver.bindings\n               .filter(binding => binding.action.methodName == 'show')\n               .map(binding => binding.action.element.parentNode);\n  }\n\n  get currentTabs() {\n    return this.tabs.filter(tab => tab.matches('.st-tabs__tab--current'));\n  }\n\n  connect() {\n    this.store = new Store(this);\n    this.store.load();\n  }\n\n  show(e) {\n    if (!e.target.matches('a[href]')) return;\n\n    this.currentTabs.forEach(tab => this.close(tab));\n    this.open(e.target.parentNode);\n\n    e.preventDefault();\n  }\n\n  open(tab) {\n    let pane = this.findPane(tab);\n    this.toggleClass(tab, pane, true);\n    this.dispatch('opened', { detail: { tab: tab, pane: pane } });\n    this.store.save();\n  }\n\n  close(tab) {\n    let pane = this.findPane(tab);\n    this.toggleClass(tab, pane, false);\n    this.dispatch('closed', { detail: { tab: tab, pane: pane } });\n    this.store.save();\n  }\n\n  toggleClass(tab, pane, flag) {\n    if (flag) {\n      tab.classList.add('st-tabs__tab--current');\n      pane.classList.add('st-tabs__pane--visible');\n    } else {\n      tab.classList.remove('st-tabs__tab--current');\n      pane.classList.remove('st-tabs__pane--visible');\n    }\n  }\n\n  findPane(tab) {\n    let id = this.getPaneID(tab);\n    return this.scope.findElement(`[data-tabs-pane-id=\"${id}\"]`);\n  }\n\n  getPaneID(tab) {\n    return tab.querySelector('a[href]').getAttribute('href').replace(/^#/, '');\n  }\n}\n"],"names":["Store","constructor","controller","this","tabs","currentTabs","key","storeKeyValue","load","ids","idSet","Set","forEach","tab","pane","findPane","has","getPaneID","toggleClass","save","map","static","json","sessionStorage","getItem","JSON","parse","value","setItem","stringify","Controller","context","bindingObserver","bindings","filter","binding","action","methodName","element","parentNode","matches","connect","store","show","e","target","close","open","preventDefault","dispatch","detail","flag","classList","add","remove","id","scope","findElement","querySelector","getAttribute","replace","values","storeKey","String"],"mappings":"sDAAqBA,EACnBC,YAAYC,GACVC,KAAKD,WAAaA,EAGhBE,WACF,YAAYF,WAAWE,KAGrBC,kBACF,YAAYH,WAAWG,YAGrBC,UACF,YAAYJ,WAAWK,cAGzBC,OACE,IAAIC,EAAMN,KAAKF,YAAYO,KAAKL,KAAKG,KACrC,GAAKG,EAAL,CAEA,IAAIC,EAAQ,IAAIC,IAAIF,GACpBN,KAAKC,KAAKQ,QAAQC,IAChB,IAAIC,EAAOX,KAAKD,WAAWa,SAASF,GAChCH,EAAMM,IAAIb,KAAKD,WAAWe,UAAUJ,IACtCV,KAAKD,WAAWgB,YAAYL,EAAKC,GAAM,GAEvCX,KAAKD,WAAWgB,YAAYL,EAAKC,GAAM,MAK7CK,OACE,IAAIV,EAAMN,KAAKE,YAAYe,IAAIP,GAAOV,KAAKD,WAAWe,UAAUJ,IAChEV,KAAKF,YAAYkB,KAAKhB,KAAKG,IAAKG,GAGvBY,YAACf,GACV,GAAKA,EAAL,CACA,IAAIgB,EAAOC,eAAeC,QAAQlB,GAClC,IACE,OAAOmB,KAAKC,MAAMJ,GAClB,SACA,cAIOD,YAACf,EAAKqB,GACVrB,GACLiB,eAAeK,QAAQtB,EAAKmB,KAAKI,UAAUF,qBC7ClBG,EAKvB1B,WACF,YAAY2B,QAAQC,gBAAgBC,SACxBC,OAAOC,GAAwC,QAA7BA,EAAQC,OAAOC,YACjCjB,IAAIe,GAAWA,EAAQC,OAAOE,QAAQC,YAGhDlC,kBACF,YAAYD,KAAK8B,OAAOrB,GAAOA,EAAI2B,QAAQ,2BAG7CC,UACEtC,KAAKuC,MAAQ,IAAI1C,EAAMG,MACvBA,KAAKuC,MAAMlC,OAGbmC,KAAKC,GACEA,EAAEC,OAAOL,QAAQ,aAEtBrC,KAAKE,YAAYO,QAAQC,GAAOV,KAAK2C,MAAMjC,IAC3CV,KAAK4C,KAAKH,EAAEC,OAAON,YAEnBK,EAAEI,kBAGJD,KAAKlC,GACH,IAAIC,EAAOX,KAAKY,SAASF,GACzBV,KAAKe,YAAYL,EAAKC,GAAM,GAC5BX,KAAK8C,SAAS,SAAU,CAAEC,OAAQ,CAAErC,IAAKA,EAAKC,KAAMA,KACpDX,KAAKuC,MAAMvB,OAGb2B,MAAMjC,GACJ,IAAIC,EAAOX,KAAKY,SAASF,GACzBV,KAAKe,YAAYL,EAAKC,GAAM,GAC5BX,KAAK8C,SAAS,SAAU,CAAEC,OAAQ,CAAErC,IAAKA,EAAKC,KAAMA,KACpDX,KAAKuC,MAAMvB,OAGbD,YAAYL,EAAKC,EAAMqC,GACjBA,GACFtC,EAAIuC,UAAUC,IAAI,yBAClBvC,EAAKsC,UAAUC,IAAI,4BAEnBxC,EAAIuC,UAAUE,OAAO,yBACrBxC,EAAKsC,UAAUE,OAAO,2BAI1BvC,SAASF,GACP,IAAI0C,EAAKpD,KAAKc,UAAUJ,GACxB,YAAY2C,MAAMC,mCAAmCF,QAGvDtC,UAAUJ,GACR,OAAOA,EAAI6C,cAAc,WAAWC,aAAa,QAAQC,QAAQ,KAAM,OA1DlEC,OAAS,CACdC,SAAUC"}